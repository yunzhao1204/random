<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ— é™æš–æš– - éšæœºè¡£æ©±ç”Ÿæˆå™¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- é…ç½®Tailwindè‡ªå®šä¹‰ä¸»é¢˜ -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#A855F7', // ä¸»è‰²è°ƒï¼šæŸ”å’Œçš„ç´«è‰²
            secondary: '#EC4899', // è¾…åŠ©è‰²ï¼šç²‰è‰²
            neutral: '#F3F4F6', // ä¸­æ€§è‰²ï¼šæµ…ç°
            dark: '#1F2937', // æ·±è‰²æ–‡æœ¬
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .table-shadow {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            .animate-number {
                transition: all 0.5s ease-out;
            }
            .category-header {
                background: linear-gradient(135deg, #A855F710, #EC489910);
            }
            /* æ·»åŠ æ‰‹é£ç´æ ·å¼ */
            .accordion-header {
                cursor: pointer;
                user-select: none;
                padding: 0.5rem 0;
            }
            .accordion-content {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease-out;
            }
            .accordion-content.active {
                max-height: 1000px;
            }
            .accordion-icon {
                transition: transform 0.3s ease;
            }
            .accordion-icon.rotate {
                transform: rotate(180deg);
            }
            
            /* æ·»åŠ ç»Ÿè®¡å¼¹çª—æ ·å¼ */
            .stats-panel {
                position: fixed;
                left: 0;
                top: 50%;
                transform: translateY(-50%);
                z-index: 1000;
                transition: all 0.3s ease;
            }
            
            .stats-content {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .stats-content.active {
                transform: translateX(0);
            }
            
            .stats-toggle {
                position: absolute;
                right: -40px;
                top: 50%;
                transform: translateY(-50%);
                width: 40px;
                height: 100px;
                background: white;
                border-radius: 0 8px 8px 0;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1);
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
            }
            
            /* åŠé€‰ä¸­æ ·å¼ */
            input[type="checkbox"]:indeterminate {
                background-color: #A855F7;
            }
            
            /* ç§»åŠ¨ç«¯è¡¨æ ¼æ ·å¼ä¼˜åŒ– */
            @media (max-width: 768px) {
                .table-responsive {
                    display: block;
                    width: 100%;
                    overflow-x: auto;
                    -webkit-overflow-scrolling: touch; /* å¢åŠ æ»šåŠ¨æµç•…åº¦ */
                }
                
                .btn-mobile-group {
                    width: 100%;
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 0.5rem;
                }
                
                .btn-mobile-full {
                    grid-column: 1 / -1;
                }
                
                .stats-panel {
                    position: fixed;
                    top: auto;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    transform: none;
                    width: 100%;
                }
                
                .stats-content {
                    transform: translateY(100%);
                    width: 100%;
                    border-radius: 16px 16px 0 0 !important;
                }
                
                .stats-content.active {
                    transform: translateY(0);
                }
                
                .stats-toggle {
                    right: auto;
                    top: -40px;
                    left: 50%;
                    transform: translateX(-50%);
                    width: 100px;
                    height: 40px;
                    border-radius: 8px 8px 0 0;
                }

                /* ç§»åŠ¨ç«¯è¡¨æ ¼åˆ—å®½è°ƒæ•´ */
                .category-col {
                    min-width: 140px !important;
                }
                .used-col {
                    min-width: 80px !important;
                }
                .max-col {
                    min-width: 100px !important;
                }
                .random-col {
                    min-width: 140px !important;
                }

                /* ç§»åŠ¨ç«¯å­—ä½“è°ƒæ•´ */
                .table-responsive td,
                .table-responsive th {
                    font-size: 0.85rem !important;
                }
                .random-number {
                    font-size: 0.75rem !important;
                    padding: 0.25rem !important;
                }
            }
        }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen text-dark">
  <!-- é¡µé¢å¤´éƒ¨ -->
    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col items-center justify-center gap-2">
            <!-- ç¬¬ä¸€è¡Œæ–‡å­— -->
            <div class="w-full max-w-md flex items-center gap-2 justify-center">
                <i class="fa fa-diamond text-primary text-xl md:text-2xl"></i>
                <h1 class="text-[clamp(1rem,4vw,1.8rem)] font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent text-center">
                æ— é™æš–æš– - éšæœºè¡£æ©±ç”Ÿæˆå™¨ âœ¨
                </h1>
            </div>
            <!-- ç¬¬äºŒè¡Œæ–‡å­— -->
            <div class="w-full max-w-md text-center">
                <p class="text-gray-600 text-center text-xs md:text-sm">
                    <i class="fa fa-info-circle text-primary mr-1"></i>é€‰æ‹©éœ€è¦åŒ…å«çš„æœè£…ç±»åˆ«ï¼Œç‚¹å‡»ç”ŸæˆæŒ‰é’®è·å–éšæœºåºå·
                </p>
            </div>
            </div>
        </div>
    </header>

  <!-- ç»Ÿè®¡ä¿¡æ¯å¼¹çª— -->
  <div class="stats-panel">
    <div class="stats-content bg-white rounded-r-xl md:rounded-r-xl shadow-lg p-4 md:p-6 active" id="stats-content">
      <div class="stats-toggle" id="stats-toggle">
        <i class="fa fa-chevron-up text-primary md:fa-chevron-right"></i>
      </div>
      <h2 class="text-xl font-bold mb-4 text-gray-800 flex items-center">
        <i class="fa fa-bar-chart text-primary mr-2"></i>è¡£æ©±ç»Ÿè®¡ ğŸ“Š
      </h2>
      <div class="grid grid-cols-2 gap-3 md:grid-cols-1 md:gap-4">
        <div class="bg-purple-50 p-3 md:p-4 rounded-lg">
          <p class="text-gray-600 text-xs md:text-sm mb-1">æ€»ç±»åˆ«æ•°</p>
          <p id="total-categories" class="text-xl md:text-2xl font-bold text-primary">0</p>
        </div>
        <div class="bg-pink-50 p-3 md:p-4 rounded-lg">
          <p class="text-gray-600 text-xs md:text-sm mb-1">å·²é€‰æ‹©ç±»åˆ«</p>
          <p id="selected-categories" class="text-xl md:text-2xl font-bold text-secondary">0</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¸»è¦å†…å®¹åŒº -->
  <main class="container mx-auto px-4 py-4 md:py-6">
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="flex flex-col items-center justify-center gap-4 mb-4 md:mb-6 p-4 bg-white rounded-xl shadow-sm w-full">
      <div class="w-full text-center">
        <p class="text-gray-600 text-sm md:text-base"><i class="fa fa-lightbulb-o text-primary mr-2"></i>é€‰æ‹©éœ€è¦åŒ…å«çš„æœè£…ç±»åˆ«ï¼Œç‚¹å‡»ç”ŸæˆæŒ‰é’®è·å–éšæœºåºå·</p>
      </div>
      <div class="flex flex-wrap justify-center gap-3 w-full">
        <button id="select-all" class="px-4 py-2.5 bg-primary/10 text-primary rounded-lg hover:bg-primary/20 transition-all flex items-center justify-center gap-2">
          <i class="fa fa-check-square-o"></i>å…¨é€‰
        </button>
        <button id="deselect-all" class="px-4 py-2.5 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-all flex items-center justify-center gap-2">
          <i class="fa fa-square-o"></i>å…¨ä¸é€‰
        </button>
        <button id="generate" class="px-6 py-2.5 bg-gradient-to-r from-primary to-secondary text-white rounded-lg hover:opacity-90 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2">
          <i class="fa fa-random"></i>ç”Ÿæˆéšæœºåºå· ğŸ²
        </button>
      </div>
    </div>

    <!-- è¡£æ©±è¡¨æ ¼ -->
    <div class="overflow-x-auto bg-white rounded-xl shadow-sm p-4 mb-4 md:mb-6 table-responsive w-full">
      <table class="w-full border-collapse min-w-[640px]"> <!-- å¢åŠ æœ€å°å®½åº¦ç¡®ä¿è¡¨æ ¼å®Œæ•´æ€§ -->
        <thead>
          <tr class="border-b-2 border-purple-100">
            <th class="py-3 px-3 md:px-4 text-left font-semibold text-gray-700 category-col w-[180px]">æœè£…ç±»åˆ« ğŸ‘—</th>
            <th class="py-3 px-3 md:px-4 text-center font-semibold text-gray-700 used-col w-1/6">æ˜¯å¦ä½¿ç”¨ âœ…</th>
            <th class="py-3 px-3 md:px-4 text-center font-semibold text-gray-700 max-col w-1/6">æœ€å¤§æ•°é‡ ğŸ”¢</th>
            <th class="py-3 px-3 md:px-4 text-center font-semibold text-gray-700 random-col w-1/2">è¡£æœåºå· ğŸ“Œ</th>
          </tr>
        </thead>
        <tbody id="wardrobe-table">
          <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </tbody>
      </table>
    </div>
  </main>

  <!-- é¡µè„š -->
  <footer class="bg-gray-800 text-white py-4 md:py-6 mt-6 md:mt-8">
    <div class="container mx-auto px-4 text-center">
      <p class="text-sm md:text-base">Â© 2023 æ— é™æš–æš–éšæœºè¡£æ©±ç”Ÿæˆå™¨ | è®¾è®¡ä¸å¼€å‘ ğŸ‘¨â€ğŸ’»</p>
      <p class="text-gray-400 text-xs md:text-sm mt-2">æœ¬å·¥å…·ä»…ç”¨äºæ¸¸æˆè¾…åŠ©ï¼Œä¸æ¸¸æˆå®˜æ–¹æ— å…³</p>
    </div>
  </footer>

  <script>
    
    // è¡£æ©±åˆ†ç±»æ•°æ®
    const wardrobeCategories = [
      {
        mainCategory: "å¤´å‘",
        subCategory: "",
        max: 449,
        used: false
      },
      {
        mainCategory: "è¿è¡£è£™",
        subCategory: "",
        max: 363,
        used: false,
        exclusiveGroup: "dress-or-separates" // ä¸ä¸Šä¸‹è¡£äº’æ–¥
      },
      {
        mainCategory: "ä¸Šè¡£",
        subCategory: "",
        max: 139,
        used: false,
        exclusiveGroup: "dress-or-separates", // ä¸è¿è¡£è£™äº’æ–¥
        requiredGroup: "top-bottom" // ä¸ä¸‹è£…å¿…é¡»åŒæ—¶é€‰ä¸­
      },
      {
        mainCategory: "ä¸‹è£…",
        subCategory: "",
        max: 144,
        used: false,
        exclusiveGroup: "dress-or-separates", // ä¸è¿è¡£è£™äº’æ–¥
        requiredGroup: "top-bottom" // ä¸ä¸Šè¡£å¿…é¡»åŒæ—¶é€‰ä¸­
      },
      {
        mainCategory: "å¤–å¥—",
        subCategory: "",
        max: 138,
        used: false
      },
      {
        mainCategory: "è¢œå­",
        subCategory: "",
        max: 319,
        used: false
      },
      {
        mainCategory: "é‹å­",
        subCategory: "",
        max: 472,
        used: false
      },
     {
        mainCategory: "é¥°å“",
        subCategory: "",
        used: false
      },
     {
        mainCategory: "é¥°å“",
        subCategory: "å‘é¥°",
        max: 271,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "å¸½å­",
        max: 399,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "è€³é¥°",
        max: 383,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "é¢ˆé¥°",
        max: 152,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "è…•é¥°",
        max: 119,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "é¡¹åœˆ",
        max: 212,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "æ‰‹å¥—",
        max: 276,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "é¢é¥°",
        max: 68,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "èƒ¸é¥°",
        max: 32,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "æŒ‚é¥°",
        max: 66,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "èƒŒé¥°",
        max: 89,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "æˆ’æŒ‡",
        max: 18,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "è‡‚é¥°",
        max: 21,
        used: false
      },
      {
        mainCategory: "é¥°å“",
        subCategory: "æ‰‹æŒç‰©",
        max: 98,
        used: false
      },
      {
        mainCategory: "å¦†å®¹",
        subCategory: "",
        used: false
      },
      {
        mainCategory: "å¦†å®¹",
        subCategory: "åº•å¦†",
        max: 37,
        used: false
      },
      {
        mainCategory: "å¦†å®¹",
        subCategory: "çœ‰å¦†",
        max: 36,
        used: false
      },
      {
        mainCategory: "å¦†å®¹",
        subCategory: "ç«æ¯›",
        max: 36,
        used: false
      },
      {
        mainCategory: "å¦†å®¹",
        subCategory: "ç¾ç³",
        max: 37,
        used: false
      },
      {
        mainCategory: "å¦†å®¹",
        subCategory: "å”‡å¦†",
        max: 37,
        used: false
      },
      {
        mainCategory: "å¦†å®¹",
        subCategory: "è‚¤è‰²è°ƒæ•´",
        max: 3,
        used: false
      },
      {
        mainCategory: "é—ªå…‰ç¥ç¦",
        subCategory: "",
        used: false
      },
      {
        mainCategory: "é—ªå…‰ç¥ç¦",
        subCategory: "å¤´éƒ¨",
        max: 101,
        used: false
      },
      {
        mainCategory: "é—ªå…‰ç¥ç¦",
        subCategory: "æ‰‹éƒ¨",
        max: 101,
        used: false
      },
      {
        mainCategory: "é—ªå…‰ç¥ç¦",
        subCategory: "è„šéƒ¨",
        max: 101,
        used: false
      }
    ];

        // DOMå…ƒç´ 
    const tableBody = document.getElementById('wardrobe-table');
    const generateBtn = document.getElementById('generate');
    const selectAllBtn = document.getElementById('select-all');
    const deselectAllBtn = document.getElementById('deselect-all');
    const totalCategoriesEl = document.getElementById('total-categories');
    const selectedCategoriesEl = document.getElementById('selected-categories');
    const statsToggle = document.getElementById('stats-toggle');
    const statsContent = document.getElementById('stats-content');
    const header = document.querySelector('header');
    
    // å®šä¹‰éœ€è¦æ‰‹é£ç´æ•ˆæœçš„åˆ†ç±»
    const accordionCategories = ['é¥°å“', 'å¦†å®¹', 'é—ªå…‰ç¥ç¦'];
    // å­˜å‚¨å„åˆ†ç±»çš„æ‰‹é£ç´çŠ¶æ€
    const accordionStates = {};

    // åˆå§‹åŒ–è¡¨æ ¼
    function initializeTable() {
      tableBody.innerHTML = '';
      
      // åˆå§‹åŒ–æ‰‹é£ç´çŠ¶æ€
        accordionCategories.forEach(category => {
            accordionStates[category] = false; // é»˜è®¤å…³é—­
         });


      wardrobeCategories.forEach((item, index) => {
        const row = document.createElement('tr');
        row.className = 'border-b border-gray-100 hover:bg-purple-50/50 transition-colors';
        
        // æœè£…ç±»åˆ«å•å…ƒæ ¼ - åº”ç”¨åˆ—ç±»
        const categoryCell = document.createElement('td');
        categoryCell.className = 'py-3 px-3 md:px-4 category-col';
        
        // ç¡®å®šæ˜¾ç¤ºå†…å®¹ï¼šæ— å­ç±»åˆ«æ˜¾ç¤ºçˆ¶ç±»åˆ«ï¼Œæœ‰å­ç±»åˆ«æ˜¾ç¤ºå­ç±»åˆ«
        const displayText = item.subCategory ? item.subCategory : item.mainCategory;
        
        // å¦‚æœæ˜¯æ‰‹é£ç´åˆ†ç±»çš„çˆ¶é¡¹ï¼Œæ·»åŠ ç‰¹æ®Šæ ·å¼å’Œäº¤äº’
        if (accordionCategories.includes(item.mainCategory) && !item.subCategory) {
          categoryCell.classList.add('font-medium', 'text-primary', 'accordion-header');
          categoryCell.innerHTML = `
            <div class="flex justify-between items-center">
              <span>${displayText}</span>
              <i class="fa fa-chevron-down accordion-icon"></i>
            </div>
          `;
          
          // æ·»åŠ ç‚¹å‡»äº‹ä»¶
          categoryCell.addEventListener('click', (e) => {
            e.stopPropagation();
            const category = item.mainCategory;
            accordionStates[category] = !accordionStates[category];
            
            // åˆ‡æ¢å›¾æ ‡æ—‹è½¬
            const icon = categoryCell.querySelector('.accordion-icon');
            icon.classList.toggle('rotate', accordionStates[category]);
            
            // æ˜¾ç¤ºæˆ–éšè—è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰å­é¡¹
            const rows = document.querySelectorAll('tr[data-main-category]');
            rows.forEach(r => {
              if (r.dataset.mainCategory === category) {
                r.style.display = accordionStates[category] ? '' : 'none';
              }
            });
          });
        } else {
          // æ™®é€šç±»åˆ«ç›´æ¥æ˜¾ç¤ºæ–‡æœ¬
          categoryCell.textContent = displayText;
        }
        
        // æ˜¯å¦ä½¿ç”¨å¤é€‰æ¡† - åº”ç”¨åˆ—ç±»
        const usedCell = document.createElement('td');
        usedCell.className = 'py-3 px-3 md:px-4 text-center used-col';
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = item.used;
        checkbox.className = 'w-5 h-5 accent-primary cursor-pointer';
        checkbox.dataset.index = index;
        
        // å¤„ç†å¤é€‰æ¡†äº‹ä»¶
        checkbox.addEventListener('change', function() {
          // å¤„ç†äº’æ–¥ç»„é€»è¾‘
          if (item.exclusiveGroup) {
            if (this.checked) {
              // å–æ¶ˆåŒç»„å…¶ä»–é€‰é¡¹
              wardrobeCategories.forEach((cat, i) => {
                if (cat.exclusiveGroup === item.exclusiveGroup && i !== index) {
                  const otherCheckbox = document.querySelector(`input[data-index="${i}"]`);
                  if (otherCheckbox) {
                    otherCheckbox.checked = false;
                    wardrobeCategories[i].used = false;
                  }
                }
              });
            }
          }
          
          // å¤„ç†ä¸Šä¸‹è£…åŒæ­¥é€‰ä¸­/å–æ¶ˆé€‰ä¸­
          if (item.requiredGroup === "top-bottom") {
            // æ— è®ºé€‰ä¸­è¿˜æ˜¯å–æ¶ˆé€‰ä¸­ï¼Œéƒ½è¦åŒæ­¥ä¸Šè¡£å’Œä¸‹è£…
            wardrobeCategories.forEach((cat, i) => {
              if (cat.requiredGroup === "top-bottom") {
                cat.used = this.checked;
                const otherCheckbox = document.querySelector(`input[data-index="${i}"]`);
                if (otherCheckbox) {
                  otherCheckbox.checked = this.checked;
                }
              }
            });
          }
          
          // å¦‚æœæ˜¯æ‰‹é£ç´åˆ†ç±»çš„çˆ¶ç±»ï¼Œéœ€è¦åŒæ­¥å­ç±»
          if (accordionCategories.includes(item.mainCategory) && !item.subCategory) {
            // æ›´æ–°æ‰€æœ‰å­ç±»
            const mainCategory = item.mainCategory;
            wardrobeCategories.forEach((cat, i) => {
              if (cat.mainCategory === mainCategory && cat.subCategory) {
                cat.used = this.checked;
                const subCheckbox = document.querySelector(`input[data-index="${i}"]`);
                if (subCheckbox) {
                  subCheckbox.checked = this.checked;
                }
              }
            });
            updateParentCheckbox(mainCategory);
          }
          
          // å¦‚æœæ˜¯æ‰‹é£ç´åˆ†ç±»ä¸­çš„å­ç±»ï¼Œéœ€è¦æ›´æ–°çˆ¶ç±»çŠ¶æ€
          if (accordionCategories.includes(item.mainCategory) && item.subCategory) {
            updateParentCheckbox(item.mainCategory);
          }
          
          wardrobeCategories[index].used = this.checked;
          updateStatistics();
        });

        usedCell.appendChild(checkbox);
        
        // æ•°é‡èŒƒå›´å•å…ƒæ ¼ï¼ˆåªæ˜¾ç¤ºæœ€å¤§å€¼è¾“å…¥æ¡†ï¼‰- åº”ç”¨åˆ—ç±»
        const rangeCell = document.createElement('td');
        rangeCell.className = 'py-3 px-3 md:px-4 text-center text-gray-600 max-col';
        
        // åªæœ‰å½“æœ‰maxå±æ€§æ—¶æ‰æ˜¾ç¤ºè¾“å…¥æ¡†ï¼ˆæ’é™¤çˆ¶ç±»åˆ«é¡¹ï¼‰
        if (item.max !== undefined && item.subCategory !== "è‚¤è‰²è°ƒæ•´") {
          const maxInput = document.createElement('input');
          maxInput.type = 'number';
          maxInput.min = '1';
          maxInput.max = item.max.toString(); // è®¾ç½®æœ€å¤§å€¼
          maxInput.value = item.max;
          maxInput.className = 'w-16 px-2 py-1 border rounded text-center';
          maxInput.dataset.index = index;
          
          // éªŒè¯è¾“å…¥å€¼æ˜¯å¦åœ¨èŒƒå›´å†…
          maxInput.addEventListener('change', function() {
            const min = parseInt(this.min);
            const max = parseInt(this.max);
            let value = parseInt(this.value) || 1;
            
            if (value < min) {
              alert(`æœ€å°å€¼ä¸èƒ½å°äº ${min}ï¼`);
              value = min;
            } else if (value > max) {
              alert(`æœ€å¤§å€¼ä¸èƒ½å¤§äº ${max}ï¼`);
              value = max;
            }
            
            this.value = value;
            wardrobeCategories[index].max = value;
          });
          
          // ç›‘å¬è¾“å…¥äº‹ä»¶ï¼Œå¤„ç†ç›´æ¥è¾“å…¥è¶…å‡ºèŒƒå›´çš„æƒ…å†µ
          maxInput.addEventListener('input', function() {
            const min = parseInt(this.min);
            const max = parseInt(this.max);
            const value = parseInt(this.value);
            
            if (value < min || value > max) {
              this.classList.add('border-red-500');
            } else {
              this.classList.remove('border-red-500');
            }
          });
          
          rangeCell.appendChild(maxInput);
        } else if (item.subCategory === "è‚¤è‰²è°ƒæ•´") {
          // å¯¹äºè‚¤è‰²è°ƒæ•´ï¼Œæ˜¾ç¤ºå›ºå®šå€¼3ï¼Œä¸æ˜¾ç¤ºè¾“å…¥æ¡†
          rangeCell.textContent = "3";
          // ç¡®ä¿æ•°æ®ä¸­è¯¥é¡¹çš„æœ€å¤§å€¼ä¸º3
          item.max = 3;
        }
        
        // è¡£æœåºå·å•å…ƒæ ¼ - åº”ç”¨åˆ—ç±»
        const randomCell = document.createElement('td');
        randomCell.className = 'py-3 px-3 md:px-4 text-center random-col';
        
        // åªæœ‰å½“æœ‰maxå±æ€§æ—¶æ‰æ˜¾ç¤ºåºå·åŒºåŸŸ
        if (item.max !== undefined) {
          const randomNumSpan = document.createElement('span');
          // è°ƒæ•´åºå·æ¡†å°ºå¯¸ï¼Œå¢åŠ å†…è¾¹è·å’Œæœ€å°å®½åº¦
          randomNumSpan.className = 'animate-number random-number inline-flex items-center justify-center rounded bg-purple-100 text-primary font-medium min-w-[100px] md:min-w-[120px] h-10 px-2';
          randomNumSpan.textContent = '';
          randomNumSpan.dataset.index = index;
          randomCell.appendChild(randomNumSpan);
        }
        
        // æ·»åŠ æ‰€æœ‰å•å…ƒæ ¼åˆ°è¡Œ
        row.appendChild(categoryCell);
        row.appendChild(usedCell);
        row.appendChild(rangeCell);
        row.appendChild(randomCell);
        
        // ä¸ºéæ ‡é¢˜è¡Œæ·»åŠ dataå±æ€§ï¼Œä¾¿äºæ‰‹é£ç´æ§åˆ¶
        if (accordionCategories.includes(item.mainCategory) && item.subCategory) {
          row.dataset.mainCategory = item.mainCategory;
          // é»˜è®¤éšè—æ‰‹é£ç´å†…å®¹
          row.style.display = 'none';
        }
        
        // æ·»åŠ è¡Œåˆ°è¡¨æ ¼
        tableBody.appendChild(row);
      });
      
      updateStatistics();
    }

    // æ›´æ–°çˆ¶ç±»å¤é€‰æ¡†çŠ¶æ€
    function updateParentCheckbox(mainCategory) {
      // æŸ¥æ‰¾è¯¥ä¸»ç±»åˆ«çš„çˆ¶ç±»å¤é€‰æ¡†
      let parentIndex = -1;
      let checkedCount = 0;
      let totalCount = 0;
      
      wardrobeCategories.forEach((item, index) => {
        if (item.mainCategory === mainCategory) {
          if (!item.subCategory) {
            parentIndex = index;
          } else {
            totalCount++;
            if (item.used) {
              checkedCount++;
            }
          }
        }
      });
      
      if (parentIndex !== -1) {
        const parentCheckbox = document.querySelector(`input[data-index="${parentIndex}"]`);
        if (parentCheckbox) {
          if (checkedCount === 0) {
            parentCheckbox.checked = false;
            parentCheckbox.indeterminate = false;
            wardrobeCategories[parentIndex].used = false;
          } else if (checkedCount === totalCount) {
            parentCheckbox.checked = true;
            parentCheckbox.indeterminate = false;
            wardrobeCategories[parentIndex].used = true;
          } else {
            parentCheckbox.checked = false;
            parentCheckbox.indeterminate = true;
            wardrobeCategories[parentIndex].used = false;
          }
        }
      }
    }

    // ç”Ÿæˆéšæœºæ•°
    function getRandomNumber(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // ç”Ÿæˆéšæœºè¡£æ©±
    function generateRandomWardrobe() {
      // æ£€æŸ¥æœè£…æ­é…è§„åˆ™
      const isDressWorn = wardrobeCategories.find(item => item.mainCategory === "è¿è¡£è£™" && item.used);
      const isTopWorn = wardrobeCategories.find(item => item.mainCategory === "ä¸Šè¡£" && item.used);
      const isBottomWorn = wardrobeCategories.find(item => item.mainCategory === "ä¸‹è£…" && item.used);
      
      // å¦‚æœæ²¡æœ‰ç©¿è¿è¡£è£™ï¼Œä¸”ä¸Šè¡£ä¸‹è£…æ²¡æœ‰åŒæ—¶ç©¿æˆ´ï¼Œåˆ™æç¤ºç”¨æˆ·
      if (!isDressWorn && !(isTopWorn && isBottomWorn)) {
        alert("å¿…é¡»ç©¿å¥½è¿è¡£è£™æˆ–ä¸Šè¡£ä¸‹è£…ç©¿æˆ´å®Œå¥½æ‰èƒ½å‡ºé—¨å“¦");
        return;
      }
      
      // æ”¶é›†æ‰€æœ‰é€‰ä¸­çš„é¡¹ç›®
      const selectedItems = [];
      wardrobeCategories.forEach((item, index) => {
        if (item.used && item.max !== undefined) {
          const randomNum = getRandomNumber(1, item.max);
          selectedItems.push({
            index: index,
            value: randomNum
          });
        }
      });
      
      // å¯¹é€‰ä¸­çš„é¡¹ç›®æŒ‰æ•°å€¼æ’åº
      selectedItems.sort((a, b) => a.value - b.value);
      
      // æ˜¾ç¤ºæ’åºåçš„ç»“æœï¼ŒåŒ…å«ä½ç½®ä¿¡æ¯
      selectedItems.forEach((item, i) => {
        const randomNumSpan = document.querySelector(`span[data-index="${item.index}"]`);
        if (randomNumSpan) {
          // è®¡ç®—è¡Œåˆ—ä½ç½®
          const row = Math.floor(i / 3) + 1;
          const col = (i % 3) + 1;
          
          // æ·»åŠ æ•°å­—å˜åŒ–åŠ¨ç”»
          randomNumSpan.style.transform = 'scale(0.8)';
          randomNumSpan.style.opacity = '0.5';
          
          setTimeout(() => {
            randomNumSpan.textContent = `${item.value}ï¼ˆ${row}è¡Œ${col}åˆ—ï¼‰`;
            randomNumSpan.style.transform = 'scale(1)';
            randomNumSpan.style.opacity = '1';
          }, 200);
        }
      });

      // æ¸…ç©ºæœªé€‰ä¸­é¡¹çš„æ˜¾ç¤º
      wardrobeCategories.forEach((item, index) => {
        const randomNumSpan = document.querySelector(`span[data-index="${index}"]`);
        if (randomNumSpan && !(item.used && item.max !== undefined)) {
          randomNumSpan.textContent = '';
        }
      });
    }
        
    // æ•°å­—åŠ¨ç”»å‡½æ•°
    function animateValue(element, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const value = Math.floor(progress * (end - start) + start);
        element.textContent = value;
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    function updateStatistics() {
        // åªç»Ÿè®¡æœ‰maxå±æ€§çš„é¡¹ç›®ï¼Œå› ä¸ºè¿™äº›æ˜¯å®é™…å¯ç”Ÿæˆéšæœºæ•°é‡çš„æœè£…ç±»åˆ«
        const filteredCategories = wardrobeCategories.filter(item => item.max !== undefined);
        
        // ç‰¹æ®Šå¤„ç†ä¸Šä¸‹è£…ç»„åˆï¼Œå°†å®ƒä»¬è§†ä¸ºä¸€ç»„
        let totalCategories = filteredCategories.length;
        let selectedCategories = filteredCategories.filter(item => item.used).length;
        
        // æ£€æŸ¥æ˜¯å¦ä¸Šè¡£å’Œä¸‹è£…éƒ½è¢«é€‰ä¸­æˆ–è€…éƒ½ä¸é€‰ä¸­
        const topIndex = wardrobeCategories.findIndex(item => item.mainCategory === "ä¸Šè¡£");
        const bottomIndex = wardrobeCategories.findIndex(item => item.mainCategory === "ä¸‹è£…");
        
        if (topIndex !== -1 && bottomIndex !== -1) {
            // å¦‚æœä¸Šè¡£å’Œä¸‹è£…éƒ½å­˜åœ¨ï¼Œå°†å®ƒä»¬è§†ä¸ºä¸€ç»„
            // æ€»ç±»åˆ«æ•°å‡1ï¼ˆå› ä¸ºä¸¤ä¸ªå˜æˆä¸€ä¸ªï¼‰
            totalCategories -= 1;
            
            // å¦‚æœä¸Šè¡£å’Œä¸‹è£…éƒ½è¢«é€‰ä¸­ï¼Œé€‰ä¸­ç±»åˆ«æ•°å‡1ï¼ˆå› ä¸ºä¸¤ä¸ªå˜æˆä¸€ä¸ªï¼‰
            if (wardrobeCategories[topIndex].used && wardrobeCategories[bottomIndex].used) {
                selectedCategories -= 1;
            }
        }
        
        totalCategoriesEl.textContent = totalCategories;
        selectedCategoriesEl.textContent = selectedCategories;
    }

    // å…¨é€‰
    function selectAll() {
      // å¤„ç†äº’æ–¥ç»„ï¼šé»˜è®¤é€‰æ‹©è¿è¡£è£™
      const exclusiveGroups = {};
      
      wardrobeCategories.forEach((item, index) => {
        // å¦‚æœæ˜¯çˆ¶ç±»ï¼Œéœ€è¦åŒæ­¥å­ç±»
        if (!item.subCategory) {
          wardrobeCategories.forEach((subItem, subIndex) => {
            if (subItem.mainCategory === item.mainCategory && subItem.subCategory) {
              subItem.used = true;
              const subCheckbox = document.querySelector(`input[data-index="${subIndex}"]`);
              if (subCheckbox) subCheckbox.checked = true;
            }
          });
        }
        
        // å¯¹äºäº’æ–¥ç»„ï¼Œæ¯ä¸ªç»„åªé€‰æ‹©ç¬¬ä¸€ä¸ª
        if (item.exclusiveGroup) {
          if (!exclusiveGroups[item.exclusiveGroup]) {
            exclusiveGroups[item.exclusiveGroup] = true;
            item.used = true;
          } else {
            item.used = false;
          }
        } 
        // å¯¹äºä¾èµ–ç»„ï¼ˆä¸Šè¡£ä¸‹è£…ï¼‰ï¼Œè¦ä¹ˆéƒ½é€‰è¦ä¹ˆéƒ½ä¸é€‰
        else if (item.requiredGroup === "top-bottom") {
          // ä¸Šè¡£ä¸‹è£…ç»„ä¸€èµ·é€‰ä¸­
          item.used = true;
        } 
        // å…¶ä»–ç‹¬ç«‹é¡¹ç›´æ¥é€‰ä¸­
        else {
          item.used = true;
        }
        
        const checkbox = document.querySelector(`input[data-index="${index}"]`);
        if (checkbox) checkbox.checked = item.used;
      });
      
      // åŒæ­¥ä¾èµ–ç»„çš„çŠ¶æ€ï¼ˆç¡®ä¿ä¸Šä¸‹è£…åŒæ—¶é€‰ä¸­ï¼‰
      const topIndex = wardrobeCategories.findIndex(item => item.mainCategory === "ä¸Šè¡£");
      const bottomIndex = wardrobeCategories.findIndex(item => item.mainCategory === "ä¸‹è£…");
      
      if (topIndex !== -1 && bottomIndex !== -1) {
        const topUsed = wardrobeCategories[topIndex].used;
        wardrobeCategories[bottomIndex].used = topUsed;
        const bottomCheckbox = document.querySelector(`input[data-index="${bottomIndex}"]`);
        if (bottomCheckbox) bottomCheckbox.checked = topUsed;
      }
      
      updateStatistics();
    }

    // å…¨ä¸é€‰
    function deselectAll() {
      wardrobeCategories.forEach((item, index) => {
        // ä¸Šè¡£ä¸‹è£…ç»„éœ€è¦ä¸€èµ·å–æ¶ˆé€‰ä¸­
        if (item.requiredGroup === "top-bottom") {
          item.used = false;
        }
        // ä¸èƒ½å–æ¶ˆä¸Šè¡£å’Œä¸‹è£…ä¸­çš„ä¸€ä¸ªï¼Œå› ä¸ºå®ƒä»¬å¿…é¡»åŒæ—¶é€‰ä¸­æˆ–ä¸é€‰ä¸­
        // æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸åšä»»ä½•æ“ä½œï¼Œä¿æŒå®ƒä»¬åŒæ­¥
        else if (!(item.requiredGroup && (item.mainCategory === "ä¸Šè¡£" || item.mainCategory === "ä¸‹è£…"))) {
          item.used = false;
        }
          
        const checkbox = document.querySelector(`input[data-index="${index}"]`);
        if (checkbox) checkbox.checked = item.used;
        
        // å¦‚æœæ˜¯æ‰‹é£ç´åˆ†ç±»çš„çˆ¶ç±»ï¼Œéœ€è¦åŒæ­¥å­ç±»
        if (accordionCategories.includes(item.mainCategory) && !item.subCategory) {
          wardrobeCategories.forEach((subItem, subIndex) => {
            if (subItem.mainCategory === item.mainCategory && subItem.subCategory) {
              subItem.used = false;
              const subCheckbox = document.querySelector(`input[data-index="${subIndex}"]`);
              if (subCheckbox) subCheckbox.checked = false;
            }
          });
        }
      });
      
      // ç‰¹æ®Šå¤„ç†ä¸Šä¸‹è£…åŒæ­¥å–æ¶ˆé€‰ä¸­
      const topIndex = wardrobeCategories.findIndex(item => item.mainCategory === "ä¸Šè¡£");
      const bottomIndex = wardrobeCategories.findIndex(item => item.mainCategory === "ä¸‹è£…");
      if (topIndex !== -1 && bottomIndex !== -1) {
        // ä¸Šä¸‹è£…éƒ½è®¾ç½®ä¸ºæœªé€‰ä¸­
        wardrobeCategories[topIndex].used = false;
        wardrobeCategories[bottomIndex].used = false;
        const topCheckbox = document.querySelector(`input[data-index="${topIndex}"]`);
        const bottomCheckbox = document.querySelector(`input[data-index="${bottomIndex}"]`);
        if (topCheckbox) topCheckbox.checked = false;
        if (bottomCheckbox) bottomCheckbox.checked = false;
      }
      
      updateStatistics();
    }

    // åˆ‡æ¢ç»Ÿè®¡é¢æ¿
    function toggleStatsPanel() {
      statsContent.classList.toggle('active');
      const icon = statsToggle.querySelector('i');
      
      // æ ¹æ®å±å¹•å®½åº¦è°ƒæ•´å›¾æ ‡
      if (window.innerWidth <= 768) {
        if (statsContent.classList.contains('active')) {
          icon.classList.remove('fa-chevron-up');
          icon.classList.add('fa-chevron-down');
        } else {
          icon.classList.remove('fa-chevron-down');
          icon.classList.add('fa-chevron-up');
        }
      } else {
        if (statsContent.classList.contains('active')) {
          icon.classList.remove('fa-chevron-right');
          icon.classList.add('fa-chevron-left');
        } else {
          icon.classList.remove('fa-chevron-left');
          icon.classList.add('fa-chevron-right');
        }
      }
    }

    // å¤„ç†æ»šåŠ¨æ—¶çš„å¯¼èˆªæ æ•ˆæœ
    function handleScroll() {
      if (window.scrollY > 10) {
        header.classList.add('py-1');
        header.classList.add('shadow');
      } else {
        header.classList.remove('py-1');
        header.classList.remove('shadow');
      }
    }

    // äº‹ä»¶ç›‘å¬
    generateBtn.addEventListener('click', generateRandomWardrobe);
    selectAllBtn.addEventListener('click', selectAll);
    deselectAllBtn.addEventListener('click', deselectAll);
    statsToggle.addEventListener('click', toggleStatsPanel);
    window.addEventListener('scroll', handleScroll);
    window.addEventListener('resize', () => {
      // å½“çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´ç»Ÿè®¡é¢æ¿å›¾æ ‡
      const icon = statsToggle.querySelector('i');
      if (window.innerWidth <= 768) {
        if (statsContent.classList.contains('active')) {
          icon.className = 'fa fa-chevron-down text-primary';
        } else {
          icon.className = 'fa fa-chevron-up text-primary';
        }
      } else {
        if (statsContent.classList.contains('active')) {
          icon.className = 'fa fa-chevron-left text-primary';
        } else {
          icon.className = 'fa fa-chevron-right text-primary';
        }
      }
    });

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', initializeTable);
  </script>
</body>
</html>